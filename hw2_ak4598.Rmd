---
title: "HW2 by AK4598"
author: "Aleya Khalifa"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(janitor)
```

This is an R Markdown file, rendered to github, that describes the process for problems 1-3. The data used in each problem has already been loaded into the project directory in the folder `data`.

# Problem 1

This problem uses FiveThiryEight data. We’ll use the data in pols-month.csv, unemployment.csv, and snp.csv. Our goal is to merge these into a single data frame using year and month as keys across datasets.

```{r}
pols <- read_csv(file = "data/fivethirtyeight_datasets/pols-month.csv")

unemployment <- read_csv(file = "data/fivethirtyeight_datasets/unemployment.csv")

snp <- read_csv(file = "data/fivethirtyeight_datasets/snp.csv")
```

## Problem 1.1

Clean the data in `pols-month.csv`. Use separate() to break up the variable `mon` into integer variables `year`, `month`, and `day`; replace month number with month name; create a `president` variable taking values `gop` and `dem`, and remove `prez_dem` and `prez_gop`; and remove the `day` variable.

```{r}
pols <- pols %>% 
  separate(mon, into = c("year", "mon", "day"), sep = "-", convert = TRUE) %>%
  mutate(mon = month.abb[mon],
         president = ifelse(prez_dem>0,"dem",
                            ifelse(prez_gop>0,"gop",
                                   NA))) %>%
  select(-prez_dem, -prez_gop, -day)
```

## Problem 1.2

Second, clean the data in `snp.csv` using a similar process to the above. For consistency across datasets, arrange according to year and month, and organize so that year and month are the leading columns.

```{r}
snp <- snp %>%
  separate(date, into = c("mon", "day", "year"), sep = "/", convert = TRUE) %>% 
  mutate(mon = month.abb[mon],
         year = as.integer(ifelse(year<16,year+2000,year+1900))) %>%
  arrange(year, mon) %>%
  relocate(year, mon) %>%
  select(-day)
```


## Problem 1.3

Third, tidy the `unemployment` data so that it can be merged with the previous datasets. This process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.

```{r}
unemployment <- unemployment %>%
  pivot_longer(Jan:Dec,
               names_to = "mon",
               values_to = "unemployment") %>%
  mutate(Year = as.integer(Year)) %>%
  clean_names()
```


## Problem 1.4

Join the datasets by merging `snp` into `pols`, and merging `unemployment` into the result.

```{r}
pols_data <- pols %>%
  left_join(snp, by = c("year", "mon")) %>%
  left_join(unemployment, by = c("year", "mon"))
```


In this problem, we took three datasets and created one long-format dataset organized by month and year. 

The original `pols` dataset had `r nrow(read_csv(file = "data/fivethirtyeight_datasets/pols-month.csv"))` observations (rows) and `r length(read_csv(file = "data/fivethirtyeight_datasets/pols-month.csv"))` variables (columns). We split the date variable into `mon` and `year` to arrange the dataset. We also created the `president` variable to reflect whether the president was republican or democrat.

The original `snp` dataset had `r nrow(read_csv(file = "data/fivethirtyeight_datasets/snp.csv"))` observations (rows) and `r length(read_csv(file = "data/fivethirtyeight_datasets/snp.csv"))` variables (columns). We again split the date variable into `mon` and `year` to arrange the dataset.

The original `unemployment` dataset had `r nrow(read_csv(file = "data/fivethirtyeight_datasets/unemployment.csv"))` observations (rows) and `r length(read_csv(file = "data/fivethirtyeight_datasets/unemployment.csv"))` variables (columns). We reorganized this dataset from wide format to long format so that months were in one column instead of spread across columns - now the `mon` variable to match the other datasets.

The `snp` and `unemployment` datasets were merged into the `pols` dataset to create the `pols_data` dataset. This final dataset includes the `close` variable and the `unemployment` variable, matched to the month-year.



# Problem 2

This problem uses Mr. Trash Wheel data. Below we import and clean the data for each trash wheel. The two main changes in each dataset is adding a variable `wheel` that reflects the specific trash wheel name, and updating the `homes_powered` variable to estimate the number of homes powered for any dumpster-date record that has a weight in tons of trash collected. 

## 1. Mr. Trash Wheel

```{r}
mr <- read_excel("data/202207 Trash Wheel Collection Data.xlsx",
                 sheet = "Mr. Trash Wheel",
                 range = "A2:N549") %>%
  clean_names() %>%
  mutate(wheel = "Mr. Trash Wheel",
         homes_powered = weight_tons*500/30) %>%
  relocate(wheel, dumpster, month, year, date, weight_tons, volume_cubic_yards, homes_powered)
```

## 2. Professor Trash Wheel

```{r}
professor <- read_excel("data/202207 Trash Wheel Collection Data.xlsx",
                 sheet = "Professor Trash Wheel",
                 range = "A2:M96") %>%
  clean_names() %>%
  mutate(wheel = "Professor Trash Wheel",
         homes_powered = weight_tons*500/30,
         year = as.character(year)) %>%
  relocate(wheel, dumpster, month, year, date, weight_tons, volume_cubic_yards, homes_powered)
```

## 3. Gwynnda

```{r}
gwynnda <- read_excel("data/202207 Trash Wheel Collection Data.xlsx",
                 sheet = "Gwynnda Trash Wheel",
                 range = "A2:K108") %>%
  clean_names() %>%
  mutate(wheel = "Gwynnda Trash Wheel",
         homes_powered = weight_tons*500/30,
         year = as.character(year)) %>%
  relocate(wheel, dumpster, month, year, date, weight_tons, volume_cubic_yards, homes_powered)
```

## 4. Combine trash wheels

```{r}
trash <- 
  bind_rows(mr, professor, gwynnda)
```


The trash dataset for Mr. Trash Wheel had `r nrow(mr)` observations of dumpster-dates (rows) and `r length(mr)` variables (columns). The trash dataset for Professor Trash Wheel had `r nrow(professor)` observations of dumpster-dates (rows) and `r length(professor)` variables (columns). The trash dataset for Gwynnda Trash Wheel had `r nrow(gwynnda)` observations of dumpster-dates (rows) and `r length(gwynnda)` variables (columns). After appending these three datasets, each reflecting dumpster-date data for a specific trash wheel, we end up with `r nrow(trash)` total observations. 

The key variables include `wheel` (name of one of the three wheels), `dumpster` (the dumpster number where trash was deposited), `weight_tons` (the weight of the trash collected at that dumpster on that date), and `homes_powered` (the estimated number of homes that could be powered by the amount of trash collected at that dumpster on that date). 

Of note, the total weight of trash collected by Professor Trash Wheel was `r round(professor %>% pull(weight_tons) %>% sum,0)` tons. The total number of cigarette butts collected by Gwynnda in July 2021 was `r format(gwynnda %>% filter(month=="July" & year=="2021") %>% pull(cigarette_butts) %>% sum, scientific=FALSE, big.mark=",")`.


# Problem 3

This problem uses Alzeihmer's disease (AD) biomarker data from the MCI dataset.

```{r}

```

